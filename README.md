# Проект «pobeda-flask»

![CI/CD](https://github.com/nikitasardov/pobeda-flask/actions/workflows/ci.yml/badge.svg)
![coverage](https://img.shields.io/endpoint?url=https://gist.githubusercontent.com/nikitasardov/fe0cbe35c07ebafcdf77b078040ec799/raw/coverage.json)

## Методология разработки

### Подход

Проект реализуется с использованием AI-ассистированной разработки (Cursor IDE).
Акцент сделан не на ручном написании кода, а на управлении процессом:
формализация требований → анализ и принятие решений → генерация кода → ревью → тестирование.

> **Результат:** три основных задания (бэкенд, фронтенд, интеграция) выполнены
> за ~1,5 часа. С добавлением тестов (unit, интеграционные, линтинг)
> и CI/CD (GitHub Actions, автодеплой) общее чистое время — не более 4 часов.

### Этапы

1. **Формализация требований.** Исходное задание разбирается на конкретные пункты.
   Выявляются неявные зависимости и пробелы (например, POST-эндпоинт,
   не указанный явно, но необходимый для выполнения задания 3).

2. **Анализ и принятие решений.** По каждому архитектурному вопросу
   (структура проекта, ORM vs raw SQL, объём CRUD, версия Python)
   фиксируется осознанный выбор с обоснованием.

3. **Планирование.** Составляется детальный чеклист с разбивкой по этапам.
   Каждый пункт — атомарная задача, которую можно выполнить и проверить
   независимо.

4. **Реализация с AI-ассистентом.** Код генерируется поэтапно, в соответствии
   с чеклистом. Каждый блок проверяется разработчиком перед переходом
   к следующему.

5. **Ревью и корректировка.** После генерации каждого модуля — проверка
   логики, стиля, обработки ошибок. Фиксируются все внесённые правки
   и выявленные проблемы.

6. **Тестирование.** Функциональная проверка всех эндпоинтов и UI
   в Docker-контейнере.

7. **Документирование.** README описывает проект и методологию,
   [CHECKLIST.md](CHECKLIST.md) отслеживает прогресс,
   [DEVLOG.md](DEVLOG.md) фиксирует ход разработки.

### Почему так

- Формализация до начала кодирования снижает количество переделок.
- Фиксация решений делает проект воспроизводимым и передаваемым.
- AI-ассистент ускоряет рутину, но ответственность за архитектуру
  и качество остаётся на разработчике.
- Атомарные коммиты по пунктам чеклиста дают прозрачную git-историю.

### Инструменты

| Назначение | Инструмент |
|---|---|
| IDE | Cursor |
| AI-ассистент | Cursor Agent |
| Контейнеризация | Docker, Docker Compose |
| Тестирование | pytest, pytest-cov |
| Линтинг фронтенда | ESLint 9, html-validate |
| Контроль версий | Git |
| Язык бэкенда | Python 3.12 + Flask |
| База данных | SQLite 3 (встроенный модуль `sqlite3`) |
| Фронтенд | HTML + vanilla JS + Bootstrap 5 |

---

## Требования из задания

### Задание 1. Бэкенд (Python)

- Веб-приложение на Flask
- SQLite база данных с информацией о пользователях (id, имя, email)
- Эндпоинт `GET /users` — список всех пользователей (JSON)
- Эндпоинт `GET /users/<id>` — пользователь по id (JSON)
- Базовая обработка ошибок (пользователь не найден)

### Задание 2. Фронтенд (JavaScript)

- HTML-страница на vanilla JS
- Fetch API для получения данных с `/users`
- Таблица со списком пользователей
- По клику на пользователя — детальная информация в модальном окне
- Bootstrap для стилизации

### Задание 3. Интеграция (Python + JavaScript)

- Форма добавления нового пользователя
- Отправка данных на бэкенд через Fetch API
- Обновление списка пользователей без перезагрузки страницы
- Сообщение об успешном добавлении или ошибке

### Проверка

- Приложение работает локально
- Скриншоты работы приложения
- Краткое описание, как запустить приложение

---

## Решения, принятые по результатам анализа

- **Структура проекта**: модульная (config / models / routes / app) — лучше читаемость и расширяемость
- **Работа с БД**: чистый `sqlite3` без ORM — меньше зависимостей, ближе к основам
- **Seed-данные**: 3–5 тестовых пользователей при первой инициализации — для наглядной демонстрации
- **Объём CRUD**: строго по заданию — только GET + POST (без PUT/DELETE)
- **POST `/users` эндпоинт**: в задании 1 явно не указан, но необходим для выполнения задания 3
- **Валидация данных**: проверка обязательных полей и формата email при создании пользователя
- **Фронтенд**: самостоятельная HTML-страница (`static/index.html`), не зависит от Flask. Раздаётся nginx
- **Архитектура**: два независимых сервиса — Flask API (`api`) и nginx (`frontend`). Фронтенд и бэкенд могут жить на разных серверах
- **Docker**: `api` — `python:3.12-slim`, `frontend` — `nginx:alpine`. nginx проксирует `/users` на Flask
- **Персистентность данных**: SQLite-файл хранится в `./data`, монтируется в контейнер как volume

---

## Структура проекта

```
pobeda-flask/
├── app/                  # Flask API (сервис api)
│   ├── __init__.py       # фабрика create_app()
│   ├── config.py
│   ├── models.py
│   └── routes.py
├── run.py                # точка входа Flask
├── static/               # Фронтенд (сервис frontend, nginx)
│   ├── index.html
│   └── js/
│       └── app.js
├── nginx/
│   └── nginx.conf        # конфиг nginx: статика + прокси /users → api
├── tests/                # тесты (pytest)
│   ├── conftest.py       # фикстуры (временная БД)
│   ├── test_models.py    # unit-тесты models.py
│   └── test_api.py       # интеграционные тесты API
├── .github/
│   └── workflows/
│       └── ci.yml        # CI/CD: тесты, линт, badge, деплой
├── data/                 # в .gitignore, монтируется в контейнер api
├── Dockerfile            # multi-stage: base (production) + test
├── Dockerfile.lint       # Node: ESLint + html-validate
├── docker-compose.yml    # сервисы: api, frontend, test и lint (профиль test)
├── requirements.txt
├── requirements-test.txt # тестовые зависимости (pytest, pytest-cov)
├── .env.example
├── .gitignore
├── README.md
├── CHECKLIST.md
├── CHECKLIST-TESTS.md
├── CHECKLIST-CICD.md
├── DEVLOG.md
└── raw_task.txt
```

---

## Запуск

### Требования

- Docker с поддержкой Compose

### Запуск приложения

```bash
docker compose up --build -d
```

Приложение будет доступно по адресу: **http://localhost:5000/**

### Остановка

```bash
docker compose down
```

### Что происходит при запуске

1. Собирается образ Flask API (`api`) из `Dockerfile`
2. Поднимается контейнер nginx (`frontend`) на базе `nginx:alpine`
3. При первом запуске создаётся файл `data/users.db` с 5 тестовыми пользователями
4. nginx раздаёт фронтенд на порту 5000 и проксирует API-запросы (`/users`) на Flask

### API-эндпоинты

| Метод | URL | Описание |
|---|---|---|
| GET | `/users` | Список всех пользователей (JSON) |
| GET | `/users/<id>` | Пользователь по id (JSON), 404 если не найден |
| POST | `/users` | Создание пользователя (JSON: `name`, `email`), 201 / 400 |

### Тесты

```bash
docker compose run --rm test
```

Unit- и интеграционные тесты (pytest). Каждый тест работает с временной БД —
продакшен-данные не затрагиваются. Результат: exit code 0/1 + отчёт покрытия.

### Линтинг фронтенда

```bash
docker compose run --rm lint
```

ESLint (JavaScript) + html-validate (HTML-структура, доступность).

### Данные

БД хранится в `./data/users.db` (монтируется как volume). Данные сохраняются между перезапусками контейнеров. Для сброса к начальному состоянию:

```bash
docker compose down
rm data/users.db
docker compose up -d
```

---

## Документы проекта

| Файл | Назначение |
|---|---|
| [CHECKLIST.md](CHECKLIST.md) | Чеклист реализации — отслеживание прогресса |
| [CHECKLIST-TESTS.md](CHECKLIST-TESTS.md) | Чеклист тестов — unit, интеграционные, CI/CD |
| [DEVLOG.md](DEVLOG.md) | Журнал разработки — что сделано, что скорректировано, какие проблемы |
| [CHECKLIST-CICD.md](CHECKLIST-CICD.md) | Чеклист CI/CD — GitHub Actions, деплой |
| [raw_task.txt](raw_task.txt) | Исходное задание (без изменений) |
